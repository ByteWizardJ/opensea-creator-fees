# Opensea Creator Fees

Opensea å‰å‡ å¤©æ¨å‡ºäº†é“¾ä¸Šç‰ˆç¨å¼ºåˆ¶æ‰§è¡Œå·¥å…·ã€‚å¼•å‘äº†å¾ˆå¤§çš„å…³æ³¨ã€‚

å› æ­¤å‡†å¤‡é€šè¿‡è¿™ç¯‡æ–‡ç« æ¥è§£é‡Šä¸‰ä¸ªé—®é¢˜ï¼š

1. ç›®å‰ç‰ˆç¨æ˜¯å¦‚ä½•æ”¶å–çš„ã€‚
2. Opensea å‡†å¤‡æ€ä¹ˆæ”¹é©ã€‚
3. ç‰ˆç¨çš„å¼ºåˆ¶æ‰§è¡Œæ˜¯å¦‚ä½•å®ç°çš„ã€‚

## ç‰ˆç¨æ˜¯å¦‚ä½•æ”¶å–çš„

é¦–å…ˆéœ€è¦ç¡®è®¤çš„æ˜¯ ERC721 æˆ–è€… ERC1155 ç±»å‹çš„ NFT åˆçº¦ä¸­æ˜¯æ²¡æœ‰æ”¶å–ç‰ˆç¨è¿™ä¸€åŠŸèƒ½çš„ã€‚åœ¨äº¤æ˜“è¿‡ç¨‹ä¸­æ— æ³•å¼ºåˆ¶æ”¶å–ç‰ˆç¨ã€‚

ç›®å‰æ”¶å–ç‰ˆç¨æ˜¯é€šè¿‡äº¤æ˜“å¹³å°è¿›è¡Œè®¾ç½®çš„ã€‚

ä»¥ Opensea è¿™ä¸ªå¹³å°ä¸ºä¾‹ã€‚å…·ä½“æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š

1. é¡¹ç›®æ–¹å‘è¡Œäº† NFTï¼Œä¹Ÿå°±æ˜¯å°†åˆçº¦éƒ¨ç½²åˆ°é“¾ä¸Šã€‚
2. Opensea è¯»å–é“¾ä¸Šæ•°æ®ï¼Œæ£€æµ‹åˆ°æœ‰æ–°çš„ NFT åˆçº¦çš„éƒ¨ç½²åã€‚ä¼šè‡ªåŠ¨ä¸ºå…¶åˆ›å»ºä¸€ä¸ª Collectionã€‚
3. é¡¹ç›®æ–¹ä½¿ç”¨ NFT åˆçº¦çš„åˆ›å»ºè€…ï¼ˆä¹Ÿå°±æ˜¯åˆçº¦çš„ Ownerï¼‰é’±åŒ…åœ°å€ç™»å½•åˆ° Opensea
4. é¡¹ç›®æ–¹æ‰“å¼€ NFT å¯¹åº” Collection é¡µé¢åä¼šçœ‹åˆ°æœ‰ä¸ªè®¾ç½®æŒ‰é’®ï¼Œç‚¹å‡»ä¹‹åå°±å¯ä»¥ä¿®æ”¹ Collection å¯¹åº”çš„ä¿¡æ¯ã€‚å…¶ä¸­å°±åŒ…æ‹¬ç‰ˆç¨çš„æ¯”ç‡ä»¥åŠæ”¶å–ç‰ˆç¨çš„åœ°å€ã€‚
5. ç”¨æˆ·åœ¨è´­ä¹° NFT çš„æ—¶å€™ï¼ŒOpensea ä¼šå°†æ€»ä»·å¯¹åº”æ¯”ç‡çš„ç‰ˆç¨æˆªç•™ä¸‹æ¥ï¼Œå¹¶å®šæœŸå‘é€ç»™é¡¹ç›®æ–¹é¢„ç•™çš„åœ°å€ã€‚

é€šè¿‡è¿™ä¸ªæµç¨‹å¯ä»¥çœ‹å‡ºæ¥ï¼Œç‰ˆç¨çš„æ”¶å–å®Œå…¨æ˜¯é“¾ä¸‹çš„æ“ä½œã€‚åªæœ‰äº¤æ˜“è€…åœ¨ Opensea ä¸ŠæŒ‚å•ä¹‹åï¼Œåç»­å‘ç”Ÿçš„äº¤æ˜“æ‰èƒ½åœ¨ Opensea ä¸Šæ”¶åˆ°ç‰ˆç¨ã€‚å¦‚æœç”¨æˆ·åœ¨å…¶ä»–å¹³å°æŒ‚å•ï¼Œå°±è¦ç”±å…¶ä»–å¹³å°æ¥æ”¶å–ç‰ˆç¨ã€‚

è¿™ä¹Ÿå°±ç»™äº†å…¶ä»–äº¤æ˜“å¹³å°çš„ä¸€äº›æ“ä½œç©ºé—´ã€‚æ¯”å¦‚ X2Y2 å°±ä¸€ä½ç‰ˆç¨æ¥æœ€ä¸ºå™±å¤´å¸å¼•äº¤æ˜“è€…ï¼ŒSudoSwap ç”šè‡³ä¸æ”¶ç‰ˆç¨ï¼Œåªæ”¶æ‰‹ç»­è´¹ã€‚

## Opensea å‡†å¤‡æ€ä¹ˆæ”¹

1. æ¨å‡ºé“¾ä¸Šç‰ˆç¨å¼ºåˆ¶æ‰§è¡Œå·¥å…·ï¼Œæ–°å‘è¡Œçš„ NFT é¡¹ç›®å¿…é¡»é›†æˆè¿™ä¸ªå·¥å…·æ‰èƒ½åœ¨ Opensea ä¸Šæ”¶å–ç‰ˆç¨ã€‚
2. é›†æˆäº†è¯¥å·¥å…·çš„ NFT æ— æ³•åœ¨ä¸€äº›è¢«é™åˆ¶çš„å¹³å°è¿›è¡Œäº¤æ˜“ã€‚
3. å¯¹äºæ–°é¡¹ç›®å’Œå¯å‡çº§çš„æ—§é¡¹ç›®ï¼Œå»ºè®®é›†æˆè¿™ä¸ªé“¾ä¸Šç‰ˆç¨å¼ºåˆ¶æ‰§è¡Œå·¥å…·æ¥æ”¶å–ç‰ˆç¨ã€‚
4. å¯¹äºæ— æ³•å‡çº§çš„æ—§é¡¹ç›®å’Œæœªé›†æˆå·¥å…·çš„æ–°é¡¹ç›®åœ¨ 12 æœˆ 8 æ—¥ä¹‹å‰ä¸è¿›è¡Œä»»ä½•æ”¹å˜ã€‚è¿™ä¸ªæ—¥æœŸä¹‹åæ˜¯å¦æ”¶å–æš‚æ—¶è¿˜ä¸ç¡®å®šã€‚
5. 11æœˆ9æ—¥æ›´æ–°äº†è§„åˆ™ï¼šOpenSea å°†ç»§ç»­å¯¹æ‰€æœ‰ç°æœ‰æ”¶è—æ”¶å–åˆ›ä½œè€…è´¹ç”¨ã€‚

## å¦‚ä½•å®ç°

ä»£ç ä»“åº“åœ°å€ï¼š[https://github.com/ProjectOpenSea/operator-filter-registry](https://github.com/ProjectOpenSea/operator-filter-registry)

å…¶å®è¿™ä¸ªå·¥å…·ä¸å…¶è¯´æ˜¯é“¾ä¸Šç‰ˆç¨å¼ºåˆ¶æ‰§è¡Œå·¥å…·ï¼Œä¸å¦‚è¯´æ˜¯é»‘åå•å·¥å…·ã€‚

ä»£ç ä¸­æœ‰ä¸‹é¢è¿™å¥è¯

> Borrows heavily from the QQL BlacklistOperatorFilter contract:
> https://github.com/qql-art/contracts/blob/main/contracts/BlacklistOperatorFilter.sol

å¯ä»¥çœ‹å‡ºèµ·åŸç†ä¸ QQL é»‘åå•å·¥å…·åŸç†ä¸€æ ·ã€‚è¿™ä¸ªå·¥å…·çš„ä¸»è¦ä½œç”¨å°±æ˜¯é™åˆ¶éƒ¨åˆ†åœ°å€è°ƒç”¨ NFT çš„ transfer æ“ä½œã€‚

è¿™é‡Œä¸»è¦æœ‰ä¸‰ä¸ªè§’è‰²éœ€è¦æ˜ç¡®ï¼š

1. operatorï¼Œæ“ä½œè€…ã€‚æŒ‡çš„æ˜¯æ“ä½œ NFT è½¬ç§»çš„åœ°å€ã€‚éœ€è¦åŠ å…¥é»‘åå•çš„ä¸€èˆ¬æ˜¯äº¤æ˜“æ‰€åˆçº¦ä¸­æ¶‰åŠä»£å¸è½¬ç§»çš„åˆçº¦åœ°å€è¿™ç§ operatorã€‚
2. registryï¼Œæ³¨å†Œè¡¨ã€‚ å¯¹åº”çš„åˆçº¦æ˜¯ OperatorFilterRegistryã€‚æ ¸å¿ƒä»£ç ï¼Œä¸»è¦é€»è¾‘éƒ½åœ¨è¿™ä¸€å—å„¿ã€‚ç”¨äºç®¡ç†æ³¨å†Œè€…ã€‚æœ€ç»ˆæ£€æŸ¥ Operator æ˜¯å¦åœ¨é»‘åå•ä¸­çš„é€»è¾‘ä¹Ÿæ˜¯åœ¨è¿™ä¸ªåˆçº¦ä¸­ã€‚
3. registrantï¼Œæ³¨å†Œè€…ã€‚å¯¹åº”çš„åˆçº¦æ˜¯ OperatorFilterer åŠå…¶å­ç±»ã€‚æ–°å‘å¸ƒçš„ NFT éœ€è¦ç»§æ‰¿è‡ªè¯¥ç±»å‹çš„åˆçº¦ã€‚

ä½¿ç”¨æµç¨‹å¦‚ä¸‹ï¼š

1. æ–°å‘å¸ƒçš„ NFT é¡¹ç›®çš„åˆçº¦å¿…é¡»ç»§æ‰¿è‡ª OperatorFilterer åŠå…¶å­ç±»ã€‚å¹¶é‡å†™ transfer ç›¸å…³çš„æ–¹æ³•ã€‚æ‰€æœ‰ transfer æ–¹æ³•éƒ½éœ€è¦æ ¡éªŒ è¯¥æ–¹æ³•çš„æ“ä½œè€…ï¼ˆoperatorï¼‰ã€‚
2. åˆçº¦åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šä½œä¸ºæ³¨å†Œè€…ï¼ˆregistrantï¼‰ï¼Œåœ¨æ³¨å†Œè¡¨ï¼ˆregistryï¼‰æ³¨å†Œéœ€è¦è¿‡æ»¤çš„ operatorã€‚
3. è®¾ç½®è¿‡æ»¤è§„åˆ™ï¼Œè¿‡æ»¤çš„è§„åˆ™æœ‰ä¸‰ç§è®¾ç½®æ–¹å¼ï¼š
   1. å¯ä»¥é€‰æ‹©è®¢é˜…æŸä¸ªå·²å­˜åœ¨çš„è§„åˆ™ï¼Œå½“è®¢é˜…çš„è¿™ä¸ªè§„åˆ™å˜åŒ–çš„æ—¶å€™ä¼šè·Ÿç€å˜åŒ–ã€‚
   2. å¤åˆ¶æŸä¸ªå·²ç»å­˜åœ¨çš„è§„åˆ™ï¼Œä¸è·Ÿç€å·²å­˜åœ¨çš„è§„åˆ™å˜åŒ–ã€‚
   3. è‡ªå·±å®šä¹‰ã€‚
4. NFT åœ¨è¿›è¡Œ transfer çš„æ—¶å€™ï¼Œä¼šå…ˆå»æ ¡éªŒè¿™ä¸ª transfer æ–¹æ³•çš„è°ƒç”¨è€… operator æ˜¯å¦åœ¨é»‘åå•ä¸­ã€‚å¦‚æœåœ¨é»‘åå•ä¸­å°±ç›´æ¥ revertã€‚

### OperatorFilterRegistry

è¿™ä¸ªåˆçº¦ç”¨äºç®¡ç†æ³¨å†Œè€…ï¼ˆregistrantï¼‰ã€‚ä¿å­˜äº†æ³¨å†Œè€…ï¼ˆregistrantï¼‰çš„å…·ä½“è¿‡æ»¤ä¿¡æ¯ã€‚é¡¹ç›®ç®¡ç†è€…å¯ä»¥é€šè¿‡å®ƒæ¥æ›´æ–°æˆ–åˆ é™¤éœ€è¦è¿‡æ»¤çš„æ“ä½œè€…ï¼ˆoperatorï¼‰ã€‚

#### å±æ€§

##### 1. EOA_CODEHASH

ç”¨äºè¿‡æ»¤ EOA è´¦æˆ·ã€‚ EOA ä¸èƒ½åŠ å…¥åˆ°æ“ä½œè€…ï¼ˆoperatorï¼‰é»‘åå•ä¸­ã€‚

```solidity
    bytes32 constant EOA_CODEHASH = keccak256("");
```

##### 2. _filteredOperators

```solidity
    mapping(address => EnumerableSet.AddressSet) private _filteredOperators;
```

ä»¥æ³¨å†Œè€…ï¼ˆregistrantï¼‰ä¹Ÿå°±æ˜¯ NFT åˆçº¦åœ°å€ä¸º key å­˜å‚¨è¯¥ NFT æ‰€æœ‰éœ€è¦è¿‡æ»¤çš„æ“ä½œè€…ï¼ˆoperatorï¼‰çš„åœ°å€ä¿¡æ¯ã€‚

è¿™é‡Œæœ‰ä¸ªæ•°æ®ç»“æ„ `EnumerableSet.AddressSet`ã€‚å¯ä»¥æŠŠå®ƒç­‰ä»·äºä¸€ä¸ªå­˜æ”¾ address ç±»å‹æ•°æ®çš„æ•°ç»„ã€‚

##### 3. _filteredCodeHashes

```solidity
    mapping(address => EnumerableSet.Bytes32Set) private _filteredCodeHashes;
```

ä»¥æ³¨å†Œè€…ï¼ˆregistrantï¼‰ä¹Ÿå°±æ˜¯ NFT åˆçº¦åœ°å€ä¸º key å­˜å‚¨è¯¥ NFT æ‰€æœ‰éœ€è¦è¿‡æ»¤çš„æ“ä½œè€…ï¼ˆoperatorï¼‰çš„ä»£ç  hash ä¿¡æ¯ã€‚

 `EnumerableSet.Bytes32Set` è·Ÿä¸Šé¢çš„åœ°å€æ•°ç»„ç±»ä¼¼ï¼Œå¯ä»¥æŠŠå®ƒç­‰ä»·äºä¸€ä¸ªå­˜æ”¾ bytes32 ç±»å‹æ•°æ®çš„æ•°ç»„ã€‚

##### 4. _registrations

```solidity
    mapping(address => address) private _registrations;
```

ä»¥ NFT åˆçº¦åœ°å€ä¸º key å­˜å‚¨è¯¥ NFT è¿‡æ»¤è§„åˆ™æ‰€å¯¹åº”çš„åœ°å€ã€‚

å°±æ˜¯è¯´ä¸€ä¸ª NFT çš„è¿‡æ»¤è§„åˆ™å¯ä»¥ä½¿ç”¨è‡ªå·±çš„ï¼Œä¹Ÿèƒ½ä½¿ç”¨åˆ«çš„ NFT å·²ç»å­˜åœ¨çš„è§„åˆ™ã€‚

##### 5. _subscribers

```solidity
    mapping(address => EnumerableSet.AddressSet) private _subscribers;
```

key æ˜¯ æŸä¸ª NFT çš„åœ°å€ã€‚value æ˜¯ä¸€ä¸ªåœ°å€é›†åˆï¼Œé›†åˆé‡Œé¢æ˜¯æ‰€æœ‰è®¢é˜…ï¼ˆsubscribeï¼‰è¯¥ NFT ç­›é€‰è§„åˆ™çš„ NFT åœ°å€ã€‚

#### ä¸»è¦æ–¹æ³•

##### 1. isOperatorAllowed

è¯¥æ–¹æ³•é€šè¿‡æ ¡éªŒæŸä¸ª operator æ˜¯å¦åœ¨æ³¨å†Œè€…ï¼ˆregistrantï¼‰å¯¹åº”çš„é»‘åå•ä¸­æ¥åˆ¤æ–­æ“ä½œæ˜¯å¦èƒ½é€šè¿‡ã€‚

```solidity
    function isOperatorAllowed(address registrant, address operator) external view returns (bool) {
        // 
        address registration = _registrations[registrant];
        if (registration != address(0)) {
            EnumerableSet.AddressSet storage filteredOperatorsRef;
            EnumerableSet.Bytes32Set storage filteredCodeHashesRef;
            
            // æ ¹æ®æ³¨å†Œè€…çš„åœ°å€ï¼ŒæŸ¥å‡ºæ¥æ‰€éœ€è¦è¿‡æ»¤çš„ operator åœ°å€
            filteredOperatorsRef = _filteredOperators[registration];
            // æ ¹æ®æ³¨å†Œè€…çš„åœ°å€ï¼ŒæŸ¥å‡ºæ¥æ‰€éœ€è¦è¿‡æ»¤çš„ operator ä»£ç  hash
            filteredCodeHashesRef = _filteredCodeHashes[registration];

            if (filteredOperatorsRef.contains(operator)) {
                revert AddressFiltered(operator);
            }
            if (operator.code.length > 0) {
                bytes32 codeHash = operator.codehash;
                if (filteredCodeHashesRef.contains(codeHash)) {
                    revert CodeHashFiltered(operator, codeHash);
                }
            }
        }
        return true;
    }
```

##### 2. register

åœ¨æ³¨å†Œè¡¨æ³¨å†Œä¸€ä¸ªåœ°å€ã€‚

ä¸€èˆ¬åœ¨åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ï¼ŒNFT ä½œä¸ºæ³¨å†Œè€…ï¼Œå°†å…¶çš„åœ°å€æ”¾åˆ° `_registrations` ä¸­ã€‚value å’Œ key éƒ½æ˜¯è¿™ä¸ªåœ°å€ã€‚è¡¨æ˜è¿‡æ»¤è§„åˆ™åœ¨å½“å‰åœ°å€å¯¹åº”çš„è§„åˆ™ä¸­ã€‚

è¿™æ—¶å€™ï¼Œè¿‡æ»¤è§„åˆ™çš„å†…å®¹æ˜¯ç©ºçš„ã€‚åç»­å¯ä»¥å‘è¿‡æ»¤å†…å®¹çš„é›†åˆä¸­åŠ å…¥éœ€è¦è¿‡æ»¤çš„ operatorã€‚

```solidity
function register(address registrant) external onlyAddressOrOwner(registrant) {
        if (_registrations[registrant] != address(0)) {
            revert AlreadyRegistered();
        }
        _registrations[registrant] = registrant;
        emit RegistrationUpdated(registrant, true);
    }
```

##### 3. registerAndSubscribe

åœ¨æ³¨å†Œå¤„æ³¨å†Œä¸€ä¸ªåœ°å€å¹¶è®¢é˜…æŸä¸ªå·²å­˜åœ¨çš„è§„åˆ™ã€‚å¦‚æœè§„åˆ™æ”¹å˜äº†ï¼Œè¿™ä¸ªæ³¨å†Œè€…çš„è§„åˆ™ä¹Ÿä¼šè·Ÿç€å˜åŒ–ã€‚

```solidity
function registerAndSubscribe(address registrant, address subscription) external onlyAddressOrOwner(registrant) {
        // è·å–æ³¨å†Œè€…å¯¹åº”çš„è¿‡æ»¤è§„åˆ™åœ°å€
        address registration = _registrations[registrant];
        // å·²ç»å­˜åœ¨ï¼Œåˆ™æŠ¥é”™
        if (registration != address(0)) {
            revert AlreadyRegistered();
        }
        // ä¸èƒ½è®¢é˜…è‡ªå·±
        if (registrant == subscription) {
            revert CannotSubscribeToSelf();
        }
        // è·å–è¦è®¢é˜…çš„è§„åˆ™å¯¹åº”çš„æ³¨å†Œè€…åœ°å€
        address subscriptionRegistration = _registrations[subscription];
        // å¦‚æœåœ°å€ä¸å­˜åœ¨ï¼Œåˆ™è¯¥è§„åˆ™ä¸å­˜åœ¨
        if (subscriptionRegistration == address(0)) {
            revert NotRegistered(subscription);
        }
        // è§„åˆ™çš„æ³¨å†Œè€…åœ°å€è¦ä¸è®¢é˜…çš„åœ°å€ç›¸åŒ
        if (subscriptionRegistration != subscription) {
            revert CannotSubscribeToRegistrantWithSubscription(subscription);
        }
        // å°†æ³¨å†Œè€…çš„è¿‡æ»¤è§„åˆ™æŒ‡å‘è¦è®¢é˜…çš„é‚£ä¸ªè§„åˆ™
        _registrations[registrant] = subscription;
        // å°†è®¢é˜…çš„ä¿¡æ¯å­˜èµ·æ¥
        _subscribers[subscription].add(registrant);
        emit RegistrationUpdated(registrant, true);
        emit SubscriptionUpdated(registrant, subscription, true);
    }
```

##### 4. registerAndCopyEntries

åœ¨æ³¨å†Œè¡¨ä¸Šæ³¨å†Œä¸€ä¸ªåœ°å€ï¼Œå¹¶ä»å¦ä¸€ä¸ªåœ°å€å¤åˆ¶è¿‡æ»¤åè§„åˆ™å’ŒcodeHashesï¼Œæ— éœ€è®¢é˜…ã€‚

è·Ÿä¸Šé¢çš„æ–¹æ³•å·®ä¸å¤šã€‚ä¸è¿‡ä¸å†è®¢é˜…æŸä¸ªè§„åˆ™ã€‚è¿‡æ»¤è§„åˆ™ä¸è·Ÿç€å˜åŒ–äº†ã€‚

```solidity
function registerAndCopyEntries(address registrant, address registrantToCopy)
        external
        onlyAddressOrOwner(registrant)
    {
        // ä¸èƒ½ä»è‡ªå·±çš„è§„åˆ™ä¸­å¤åˆ¶
        if (registrantToCopy == registrant) {
            revert CannotCopyFromSelf();
        }
        // è·å–æ³¨å†Œè€…å¯¹åº”çš„è¿‡æ»¤è§„åˆ™åœ°å€
        address registration = _registrations[registrant];
        if (registration != address(0)) {
            revert AlreadyRegistered();
        }
        // è·å–å°†è¦å¤åˆ¶çš„è§„åˆ™å¯¹åº”çš„æ³¨å†Œè€…åœ°å€
        address registrantRegistration = _registrations[registrantToCopy];
        // è¿™ä¸ªè§„åˆ™å¯¹åº”çš„æ³¨å†Œè€…å¿…é¡»å­˜åœ¨
        if (registrantRegistration == address(0)) {
            revert NotRegistered(registrantToCopy);
        }
        // è®¾ç½®æ³¨å†Œè€…å¯¹åº”çš„è¿‡æ»¤è§„åˆ™å¯¹åº”åœ°å€
        _registrations[registrant] = registrant;
        emit RegistrationUpdated(registrant, true);
        // å°†è§„åˆ™å¤åˆ¶åˆ°å½“å‰æ³¨å†Œè€…åä¸‹
        _copyEntries(registrant, registrantToCopy);
    }
```

### OperatorFilterer

è¯¥åˆçº¦å……å½“æ³¨å†Œè€…çš„è§’è‰²ã€‚è¦æƒ³ç¬¦åˆ Opensea è§„åˆ™ç»§ç»­æ”¶ç‰ˆç¨ï¼Œé¡¹ç›®æ–¹çš„ NFT åˆçº¦å°±å¿…é¡»ç»§æ‰¿è‡ªè¯¥åˆçº¦ã€‚å¹¶ä¸”è¦è¿‡æ»¤ä¸€äº›æŒ‡å®šçš„ operatorã€‚

> Contract owners may implement their own filtering outside of this registry, or they may use this registry to curate their own lists of filtered operators. However, there are certain contracts that are filtered by the default subscription, and must be filtered in order to be eligible for creator fee enforcement on OpenSea.
> 
> åˆçº¦æ‰€æœ‰è€…å¯ä»¥åœ¨æ­¤æ³¨å†Œè¡¨ä¹‹å¤–å®æ–½ä»–ä»¬è‡ªå·±çš„è¿‡æ»¤ï¼Œæˆ–è€…ä»–ä»¬å¯ä»¥ä½¿ç”¨æ­¤æ³¨å†Œè¡¨æ¥ç®¡ç†ä»–ä»¬è‡ªå·±çš„è¿‡æ»¤æ“ä½œå‘˜åˆ—è¡¨ã€‚ä½†æ˜¯ï¼ŒæŸäº›åˆçº¦ä¼šè¢«é»˜è®¤è®¢é˜…è¿‡æ»¤ï¼Œå¹¶ä¸”å¿…é¡»è¿‡æ»¤æ‰èƒ½æœ‰èµ„æ ¼åœ¨ OpenSea ä¸Šæ‰§è¡Œåˆ›ä½œè€…è´¹ç”¨ã€‚

<table>
<tr>
<th>Name</th>
<th>Address</th>
<th>Network</th>
</tr>

<tr>
<td>Blur.io ExecutionDelegate</td>
<td >
0x00000000000111AbE46ff893f3B2fdF1F759a8A8
</td>
<td >
Ethereum Mainnet
</td>
</tr>

<tr>
<td>LooksRare TransferManagerERC721</td>
<td>0xf42aa99F011A1fA7CDA90E5E98b277E306BcA83e</td>
<td>Ethereum Mainnet</td>
</tr>

<tr>
<td>LooksRare TransferManagerERC1155</td>
<td>0xFED24eC7E22f573c2e08AEF55aA6797Ca2b3A051</td>
<td>Ethereum Mainnet</td>
</tr>

<tr>
<td><strike> X2Y2 ERC721Delegate<strike></td>
<td><strike>0xf849de01b080adc3a814fabe1e2087475cf2e354<strike></td>
<td><strike>Ethereum Mainnet<strike></td>
</tr>

<tr>
<td><strike>X2Y2 ERC1155Delegate<strike></td>
<td><strike>0x024ac22acdb367a3ae52a3d94ac6649fdc1f0779<strike></td>
<td><strike>Ethereum Mainnet<strike></td>
</tr>

<tr>
<td>SudoSwap LSSVMPairRouter</td>
<td>0x2B2e8cDA09bBA9660dCA5cB6233787738Ad68329</td>
<td>Ethereum Mainnet</td>
</tr>

</table>

æ›´æ–°ï¼šX2Y2 å®£å¸ƒæ”¯æŒç‰ˆç¨ã€‚OperatorFilterRegistry ä¸­çš„ X2Y2 ç›¸å…³çš„åœ°å€å·²è¢«åˆ é™¤ã€‚
#### å±æ€§

##### 1. operatorFilterRegistry

æ³¨å†Œè¡¨çš„åœ°å€ã€‚

```solidity
IOperatorFilterRegistry constant operatorFilterRegistry =
        IOperatorFilterRegistry(0x000000000000AAeB6D7670E522A718067333cd4E);
```

#### æ–¹æ³•å’Œä¿®é¥°å™¨

##### 1. åˆå§‹åŒ–æ–¹æ³•

```solidity
    // åˆå§‹åŒ–çš„ä¸¤ä¸ªå‚æ•°:
    // 1. subscriptionOrRegistrantToCopy: å°†è¦è®¢é˜…æˆ–è€…å¤åˆ¶è¿‡æ»¤è§„åˆ™çš„æ³¨å†Œè€…åœ°å€
    // 2. subscribe: æ˜¯å¦è¦è¿›è¡Œè®¢é˜…
    constructor(address subscriptionOrRegistrantToCopy, bool subscribe) {
        // If an inheriting token contract is deployed to a network without the registry deployed, the modifier
        // will not revert, but the contract will need to be registered with the registry once it is deployed in
        // order for the modifier to filter addresses.
        // æ³¨å†Œè¡¨å¿…é¡»è¢«éƒ¨ç½²äº†æ‰ä¼šè¿›è¡Œæ³¨å†Œ
        if (address(operatorFilterRegistry).code.length > 0) {
            // å¦‚æœæ˜¯è®¢é˜…
            if (subscribe) {
                // å°†æ³¨å†Œä¿¡æ¯æ”¾åˆ°æ³¨å†Œè¡¨ä¸­å¹¶è®¢é˜…æŒ‡å®šçš„è¿‡æ»¤ä¿¡æ¯
                operatorFilterRegistry.registerAndSubscribe(address(this), subscriptionOrRegistrantToCopy);
            } else {
                // ä¸æ˜¯è®¢é˜…ä¸”è§„åˆ™å¯¹åº”æ³¨å†Œè€…çš„åœ°å€å­˜åœ¨
                if (subscriptionOrRegistrantToCopy != address(0)) {
                    // å°†æ³¨å†Œä¿¡æ¯æ”¾åˆ°æ³¨å†Œè¡¨ä¸­å¹¶å¤åˆ¶æŒ‡å®šçš„è¿‡æ»¤ä¿¡æ¯
                    operatorFilterRegistry.registerAndCopyEntries(address(this), subscriptionOrRegistrantToCopy);
                } else {
                    // éƒ½ä¸æ˜¯ï¼Œåˆ™åªæ³¨å†Œåˆ°æ³¨å†Œè¡¨ä¸­ã€‚è¿‡æ»¤è§„åˆ™ä¿¡æ¯æ²¡æœ‰è®¾ç½®ã€‚
                    operatorFilterRegistry.register(address(this));
                }
            }
        }
    }
```

##### 2. `onlyAllowedOperator` ä¿®é¥°å™¨

æ‰€æœ‰éœ€è¦è¿›è¡Œé™åˆ¶çš„æ–¹æ³•éƒ½éœ€è¦åŠ ä¸Šè¯¥ä¿®é¥°å™¨ã€‚å¯¹åº” NFT åˆçº¦æ¥è¯´æ‰€æœ‰çš„ transfer æ–¹æ³•éƒ½è¦åŠ ä¸Šè¿™ä¸ªä¿®é¥°å™¨ã€‚

```solidity
modifier onlyAllowedOperator(address from) virtual {
        // Check registry code length to facilitate testing in environments without a deployed registry.
        // æ³¨å†Œè¡¨å¿…é¡»è¢«éƒ¨ç½²äº†æ‰ä¼šè¿›è¡Œæ ¡éªŒ
        if (address(operatorFilterRegistry).code.length > 0) {
            // Allow spending tokens from addresses with balance
            // Note that this still allows listings and marketplaces with escrow to transfer tokens if transferred
            // from an EOA.
            // å…è®¸ from ä¸ è°ƒç”¨è€…ç›¸åŒæ—¶çš„æ“ä½œã€‚
            // ä¸€èˆ¬è¿™ç§æƒ…å†µæ˜¯ EOA è´¦æˆ· è‡ªå·±è½¬å‡º NFT æˆ–è€…æ˜¯å°† NFT è¿›è¡Œæ‰˜ç®¡ç»™äº¤æ˜“æ‰€ï¼Œç”±äº¤æ˜“æ‰€è¿›è¡Œè½¬ç§»ï¼Œæ¯”å¦‚ sudoswapã€‚
            if (from == msg.sender) {
                _;
                return;
            }
            if (
                !(  // æ ¡éªŒ msg.sender æ˜¯å¦åœ¨å½“å‰NFTåˆçº¦çš„é»‘åå•ä¸­
                    operatorFilterRegistry.isOperatorAllowed(address(this), msg.sender)
                    && // æ ¡éªŒ from æ˜¯å¦åœ¨å½“å‰NFTåˆçº¦çš„é»‘åå•ä¸­
                    operatorFilterRegistry.isOperatorAllowed(address(this), from)
                )
            ) {
                revert OperatorNotAllowed(msg.sender);
            }
        }
        _;
    }
```


###### ä¸ºä»€ä¹ˆè¦é™åˆ¶ `msg.sender`

> If the application most commonly used to interface with the contract gives buyers and sellers the ability to bypass creator fees when a similar transaction for the same item would require creator fee payment on OpenSea.io

å°±æ˜¯è¯´æœ‰äº›åº”ç”¨ç»™äºˆäº†ä¹°å–åŒæ–¹ç»•è¿‡ç‰ˆç¨çš„èƒ½åŠ›ã€‚è¿™ä¸ªè¯´çš„åº”è¯¥å°±æ˜¯ä¸€äº›ä½ç‰ˆç¨çš„äº¤æ˜“å¸‚åœºäº†ã€‚

å…ˆçœ‹ä¸€ä¸‹ Opensea è¦é™åˆ¶çš„åˆçº¦æ˜¯ Blur.io `ExecutionDelegate`ã€LooksRare `TransferManagerERC721`ã€LooksRare `TransferManagerERC1155`ã€X2Y2 `ERC721Delegate`ã€X2Y2 `ERC1155Delegate`ã€‚

è¿™äº›åˆçº¦çš„ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹å°±æ˜¯è´Ÿè´£æˆäº¤ä¹‹åçš„ä»£å¸è½¬ç§»ã€‚

ä»¥ Blur ä¸ºä¾‹ã€‚ç”¨æˆ·äº¤äº’çš„ä¸»åˆçº¦æ˜¯ `BlurExchange`ã€‚æˆå•æ–¹æ³•æ˜¯ `execute()`ã€‚è¿™ä¸ªæ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨ `ExecutionDelegate` çš„ `transferERC20()` ã€`transferERC721()` ã€`transferERC1155` æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å†å»è°ƒç”¨å…·ä½“çš„åˆçº¦çš„ transfer æ–¹æ³•æ¥è¿›è¡Œè½¬ç§»ä»£å¸ã€‚ï¼ˆå…·ä½“å®ç°å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„æ–‡ç« ï¼šhttps://github.com/cryptochou/blur-analysisï¼‰

å› æ­¤åœ¨è¿™ä¸ªæ—¶å€™ transfer æ–¹æ³•çš„ `msg.sender` å°±æ˜¯ `BlurExchange`ã€‚å› æ­¤é™åˆ¶äº† `msg.sender` å°±èƒ½é™åˆ¶ Blur ä¸Šçš„äº¤æ˜“ã€‚

SudoSwap çš„ç‰¹æ®Šæ€§ã€‚ 

SudoSwap ä½œä¸ºå»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼Œä½¿ç”¨äº† AMM æœºåˆ¶ï¼Œå®ƒæœ‰æµåŠ¨æ± çš„æ¦‚å¿µã€‚ç”¨æˆ·å¯ä»¥å°† NFT æ”¾åˆ°æµåŠ¨æ± ä¸­ï¼Œè·å– ETH æˆ– ERC20 ä»£å¸ï¼Œè¡¨ç¤ºç”¨æˆ·å°† NFT å–ç»™äº†æµåŠ¨æ± ã€‚ä¹Ÿå¯ä»¥å°† ETH æˆ– ERC20 ä»£å¸æ”¾åˆ°æµåŠ¨æ± ä¸­ï¼Œæ‹¿å‡º NFTï¼Œè¡¨ç¤ºç”¨æˆ·ä¹°å…¥äº† NFTã€‚ï¼ˆæ›´å…·ä½“çš„å®ç°å¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼šhttps://github.com/cryptochou/sudoswap-analysisï¼‰

åœ¨ç”¨æˆ·å°† NFT å–ç»™æµåŠ¨æ± ä¸­çš„æ—¶å€™ï¼Œæœ€ç»ˆä¼šç”± `LSSVMPairRouter` çš„ `pairTransferNFTFrom()` æ–¹æ³•æ¥è°ƒç”¨ NFT çš„ `safeTransferFrom()` æ–¹æ³•æ¥è¿›è¡Œ transferã€‚è¿™ä¸ªæ—¶å€™çš„ `safeTransferFrom()` çš„ `msg.sender` å°±æ˜¯ `LSSVMPairRouter`ã€‚è¿™ä¸ªæ—¶å€™é™åˆ¶ transfer æ–¹æ³•çš„ `msg.sender` å°±å¯ä»¥é™åˆ¶ Sudoswap ä¸Šå­˜å…¥æµåŠ¨æ± çš„æ“ä½œã€‚

åœ¨ç”¨æˆ·ç”¨ ETH æˆ–è€… ERC20 ä»£å¸ä¹°æµåŠ¨æ± çš„ NFT çš„æ—¶å€™ï¼Œæœ€ç»ˆä¼šç”±æµåŠ¨æ± ï¼ˆ`LSSVMPair`ï¼‰çš„ `_sendAnyNFTsToRecipient()` æˆ–è€… `_sendSpecificNFTsToRecipient()` æ–¹æ³•è°ƒç”¨ NFT çš„ `safeTransferFrom()` æ–¹æ³•æ¥è¿›è¡Œ transferã€‚`from` å‚æ•°å°±æ˜¯æµåŠ¨æ± æœ¬èº«ã€‚è¿™ä¸ªæ—¶å€™ `from == msg.sender` ï¼Œä¸è¿›è¡Œé™åˆ¶ã€‚ä¸è¿‡æ—¢ç„¶æ— æ³•å­˜å…¥æµåŠ¨æ± ï¼Œå°±ä¸ä¼šå­˜åœ¨ä»æµåŠ¨æ± ä¸­æ¢å‡º NFT çš„æ“ä½œäº†ã€‚

###### ä¸ºä»€ä¹ˆè¦é™åˆ¶ `from`

ç›®å‰è¿˜æ²¡æœ‰æƒ³åˆ°è¿™ç§æƒ…å½¢æ˜¯ä»€ä¹ˆæƒ…å†µä¸‹å‡ºç°çš„ã€‚æœ‰çŸ¥é“çš„æœ‹å‹æ¬¢è¿ç§ä¿¡ğŸ¤ã€‚

#### DefaultOperatorFilterer

DefaultOperatorFilterer æ˜¯ OperatorFilterer çš„ä¸€ä¸ªå­ç±»å®ç°ã€‚åˆå§‹åŒ–çš„æ—¶å€™ä¼šè‡ªåŠ¨è®¢é˜… `0x3cc6CddA760b79bAfa08dF41ECFA224f810dCeB6` è¿™ä¸€åœ°å€å¯¹åº”çš„è¿‡æ»¤è§„åˆ™ã€‚

ç®€å•æ¥è¯´é¡¹ç›®æ–¹ç›´æ¥ä½¿ç”¨è¿™ä¸ªç»§æ‰¿è¿™ä¸ªåˆçº¦æ¥å¼€å‘ NFT å°±æ¥å…¥å¹¶è®¢é˜…äº† Opensea å®˜æ–¹çš„è¿‡æ»¤è§„åˆ™ã€‚åç»­å®˜æ–¹è§„åˆ™æ”¹å˜çš„è¯ä¹Ÿä¼šè·Ÿç€å˜æ¢ã€‚

## æ€»ç»“

ä»ä¸Šé¢çš„ä»£ç åˆ†æå¯ä»¥çœ‹å‡ºæ¥ï¼Œè™½ç„¶ Opensea å°†å…¶åŒ…è£…çš„å¾ˆå¥½ï¼Œä½†æ˜¯è¿™ä¸ªæ‰€è°“çš„å¼ºåˆ¶ç‰ˆç¨å·¥å…·å®é™…ä¸Šæ˜¯ä¸ªäº¤æ˜“é»‘åå•å·¥å…·ã€‚é›†æˆäº†è¯¥å·¥å…·çš„ NFT é¡¹ç›®å°±æ— æ³•åœ¨ä¸€äº›å¹³å°äº¤æ˜“ã€‚

Opensea blog ä¸­æ»¡ç¯‡çš„è§£é‡Šæ–‡å­—ä¸­ä¹Ÿå¤„å¤„é€æ¼ç€è…¾è®¯çš„é‚£ç§â€œæˆ‘ä»¬åšå‡ºäº†ä¸€ä¸ªè‰°éš¾çš„å†³å®šâ€çš„æ„å‘³ã€‚çœ‹æ¥ Blur ç­‰å¹³å°çš„ç¡®å®å¯¹ Opensea é€ æˆäº†å¾ˆå¤§çš„å¨èƒã€‚

è‡³äºè¿™ä¸ªèƒ½ä¸èƒ½æ‰§è¡Œä¸‹å»å°±çœ‹ç”¨æˆ·å’Œé¡¹ç›®æ–¹ç”¨è„šæ¥è¿›è¡ŒæŠ•ç¥¨äº†ã€‚

æ›´æ–°ï¼šX2Y2 å·²ç»è®¤æ€‚äº†ã€‚ã€‚ã€‚https://twitter.com/the_x2y2/status/1593631419561304067

## å‚è€ƒ

1. [opensea blog: On Creator Fees](https://opensea.io/blog/announcements/on-creator-fees/)
2. [operator-filter-registry](https://github.com/ProjectOpenSea/operator-filter-registry)
3. [jason chen çš„æ¨æ–‡](https://twitter.com/jason_chen998/status/1589291754129625089)
4. [opensea 11 æœˆ 9 æ—¥ æ›´æ–°çš„è¯´æ˜](https://twitter.com/opensea/status/1590466334814785537?s=20&t=03NJGkvgayNDVjWKo53vxA)